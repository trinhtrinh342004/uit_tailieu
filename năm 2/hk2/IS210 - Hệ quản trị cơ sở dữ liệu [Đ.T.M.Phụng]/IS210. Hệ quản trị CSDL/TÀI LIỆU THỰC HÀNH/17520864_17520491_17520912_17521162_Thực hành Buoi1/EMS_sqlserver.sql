CREATE DATABASE EMPLOYEE_MANAGEMENT
USE EMPLOYEE_MANAGEMENT

CREATE TABLE EMPLOYEE
(
	EMPNO VARCHAR(5) PRIMARY KEY,
	EMPNAME VARCHAR(20),
	BIRTHDAY SMALLDATETIME,
	DEPTNO VARCHAR(10),
	MGRNO VARCHAR(5) NOT NULL,
	STARTDATE SMALLDATETIME,
	SALARY MONEY,
	LEVEL INT,
	STATUS INT,
	NOTE VARCHAR(250),
)

CREATE TABLE SKILL
(
	SKILLNO INT PRIMARY KEY IDENTITY(1,1),
	SKILLNAME VARCHAR(20),
	NOTE VARCHAR(250),
)

CREATE TABLE EMP_SKILL
(
	
	SKILLLEVEL INT,
	REGDATE SMALLDATETIME,
	DESCRIPTION VARCHAR(250),
	SKILLNO INT CONSTRAINT FK_EMP_SKILL_SKILL FOREIGN KEY REFERENCES SKILL(SKILLNO),
	EMPNO VARCHAR(5) CONSTRAINT FK_EMP_SKILL_EMPLOYEE FOREIGN KEY REFERENCES EMPLOYEE(EMPNO),
	CONSTRAINT PK_EMP_SKILL PRIMARY KEY (SKILLNO,EMPNO),
)

CREATE TABLE DEPARTMENT
(
	DEPTNO INT IDENTITY(1,1) PRIMARY KEY,
	DEPTNAME VARCHAR(20),
	NOTE VARCHAR(250),
)

----- CÂU 1
ALTER TABLE EMPLOYEE
ADD CHECK (LEVEL BETWEEN 1 AND 7)

ALTER TABLE EMPLOYEE
ADD CHECK (STATUS IN(0,1,2))

ALTER TABLE EMP_SKILL
ADD CHECK (SKILLLEVEL BETWEEN 1 AND 3)

----- CÂU 2
/*A THÊM EMAIL*/
ALTER TABLE EMPLOYEE
ADD EMAIL VARCHAR(50) UNIQUE

/*B ĐẶT GIÁ TRỊ MẶC ĐỊNH*/
ALTER TABLE EMPLOYEE
ADD DEFAULT('0') FOR MGRNO
ALTER TABLE EMPLOYEE
ADD DEFAULT(0) FOR STATUS

---- CÂU 3
/*A*/
ALTER TABLE EMPLOYEE
ADD CONSTRAINT FK_EMPLOYEE_DEPARTMENT FOREIGN KEY (DEPTNO) REFERENCES  DEPARTMENT(DEPTNO)

/*B*/
ALTER TABLE EMP_SKILL
DROP COLUMN DESCRIPTION

---- CÂU 4
/*CÂU A*/
SET DATEFORMAT DMY

INSERT INTO EMPLOYEE VALUES ('NV001','NGUYEN VAN A','01/01/1978','DE001','NV006','03/02/2019',30000000,1,2,NULL,'A@GMAIL.COM'),
('NV002','NGUYEN VAN B','01/01/1979','DE002','NV006','03/02/2019',30000000,3,0,NULL,'B@GMAIL.COM'),
('NV003','NGUYEN VAN C','03/01/1982','DE003','NV006','03/02/2019',30000000,2,2,NULL,'C@GMAIL.COM'),
('NV004','NGUYEN VAN D','02/05/1979','DE001','NV006','03/02/2019',30000000,4,2,NULL,'D@GMAIL.COM'),
('NV005','NGUYEN VAN E','03/08/1982','DE003','NV006','03/02/2019',30000000,1,2,NULL,'E@GMAIL.COM')
INSERT INTO SKILL VALUES ('KN001',NULL),
('KN002',NULL),
('KN003',NULL),
('KN004',NULL),
('KN005',NULL)
INSERT INTO EMP_SKILL VALUES (2,'01/03/2018',1,'NV001'),
(3,'01/02/2018',3,'NV002'),
(1,'01/05/2018',4,'NV005'),
(2,'01/06/2018',5,'NV001'),
(2,'01/09/2018',1,'NV003')
INSERT INTO DEPARTMENT VALUES('LINH TRUNG',NULL),
('CO BAC', NULL),
('LINH TRUNG 2',NULL),
('LINH TAY',NULL),
('KHA VAN CAN',NULL)


/*CÂU B*/
CREATE VIEW EMPLOYEE_TRACKING AS
	SELECT EMPNO,EMPNAME, LEVEL
	FROM EMPLOYEE
	WHERE LEVEL >=3 AND LEVEL <=5